import Container from '../../components/Container'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import PlatformTabs from '../../components/PlatformTabs'
import PlatformTabItem from '../../components/PlatformTabItem'
import CloudBanner from '../../components/CloudBanner'

# Migration Guide

<PlatformTabs
  groupId="api"
  activeOptions={["web"]}
>

<PlatformTabItem value="hooks">

## Migrating from 0.x to 1.0.0 
There are numerous breaking changes in the stable release.

### Package rename
While `@web3inbox/core` is still named the same way, `@web3inbox/widget-react` is now `@web3inbox/react`. 

### Managing Accounts
Previously, the account needed to be set using `setAccount` and still had to be passed down to hooks like `useManageSubscriptions`. This is no longer
the case. Also, registration management was included in the same hook. Now they all follow single responsibility principle. 

#### Setting accounts

##### Old

```javascript
import { useW3iAccount } from "@web3inbox/widget-react"

const { setAccount } = useW3iAccount()

setAccount(`eip155:1:0x...`)
```

##### New

```javascript
import { useWeb3InboxAccount } from "@web3inbox/react"

const { data: account } = useWeb3InboxAccount(`eip155:1:0x...`)
```

#### Handling registration

##### Old

```javascript
import { useW3iAccount } from "@web3inbox/widget-react"
import { signMessageAsync } from "@wagmi/core"

const { setAccount, register } = useW3iAccount()

setAccount(`eip155:1:0x...`)

const handleRegistration = () => {
  register(signMessageAsync)
}
```

##### New 

With this new methodology, there is full control over where and how the user is registered as opposed to the previous method.

```javascript
import { useWeb3InboxAccount, useRegister, usePrepareRegistration } from "@web3inbox/react"
import { signMessageAsync } from "@wagmi/core"

const { data: account, isRegistered } = useWeb3InboxAccount(`eip155:1:0x...`)
const { prepareRegistration } = usePrepareRegistration();
const { register, isLoading: isLoadingRegister } = useRegister();

const handleRegistration = async () => {
  try {
    const { message, registerParams } = await prepareRegistration();
    const signature = await signMessageAsync({ message: message });
    await register({ registerParams, signature });
  } catch (registerIdentityError: any) {
    console.error(registerIdentityError)
  }
};
```

### Managing notifications
Messages (notifications) function a little differently now. One of the big changes is that you can no longer delete messages.
Furthermore, messages can now be paged. For convenience, "infinte scroll" paging functionality is available, as in keeping older pages in the
returned array.

#### Retrieving notifications

##### Old

```javascript
import { useMessages } from "@web3inbox/widget-react"

const { messages } = useMessages()
```

##### New

```javascript
import { useNotifications } from "@web3inbox/react"

const notificationsPerPage = 5
const isInfiniteScroll = true

const { data: notifications, nextPage } = useNotifications(notificationsPerPage, isInfiniteScroll)

const getMoreNotifications = () => {
  nextPage()
}
```

#### Retrieving notification types

##### Old

```javascript
import { useSubscriptionScopes } from "@web3inbox/widget-react"

const { scopes } = useSubscriptionScopes()
```

##### New

**Important note**: Notification images are retrieved from notification types now. 

Sizes of images available are: `sm`, `md` and `lg` for small, medium and large respectively.

```javascript
import { useNotificationTypes } from "@web3inbox/react"

const { data: notificationTypes } = useNotificationTypes()

notificationTypes[notification.type].imageUrls.md; 
```

### Managing Subscriptions
Managing subscriptions has changed considerably. Previously there was a single hook and now there are numerous single responsibility hooks.

#### Old

```javascript
import { useManageSubscription } from "@web3inbox/widget-react"

const { subscribe, unsubscribe, isSubscribed } = useManageSubscription()
```

#### New

```javascript
import { useSubscribe, useUnsubscribe, useSubscription } from "@web3inbox/react"

const { subscribe } = useSubscribe()
const { unsubscribe } = useUnsubscribe()
const { data: subscription } = useSubscription()
```

</PlatformTabItem>

<PlatformTabItem value="web">

## Migrating from 0.14.x to 0.15.x

There is a breaking change with registering between the minor versions.

- `isLimited` has been replaced with `allApps`, its inverse, to avoid double-negatives. Whenever `isLimited` is set to false, `allApps` should now be true and vise-versa.
- Instead of passing an `onSign` callback to `register()`, registration takes place in multiple steps: `prepareRegistration()`, the signature, and `register()`
- Instead of calling `register()` immediately, one must first prepare a registration via `prepareRegistration()`
- After getting the `registerParams` and a `message`, the message must be signed and the signature passed to `register()` along with `registerParams`.

### Old

```javascript
const account = `eip155:1:0x63Be2c680685d2A9620c11b0068291261aa62d76`
const onSign = (message: string) => ethersWallet.signMessage(message)

await notifyClient.register({
  account,
  onSign,
  domain: 'com.example.app.rn', // pass your app's bundle identifier.
  isLimited: false
})
```

### New Equivalent

```javascript
const account = `eip155:1:0x63Be2c680685d2A9620c11b0068291261aa62d76`
const domain =  'app.mydomain.com', // pass the domain (i.e. the hostname) where your dapp is hosted.
const allApps = true

// No need to register and sign message if already registered.
if (notifyClient.isRegistered({ account, domain, allApps })) return;

const { registerParams, message }  = notifyClient.prepareRegistration({
  account,
  domain,
  allApps
});

const signature = await ethersWallet.signMessage(message);

await notifyClient.register({
  registerParams,
  signature,
})
```

</PlatformTabItem>

</PlatformTabs>
